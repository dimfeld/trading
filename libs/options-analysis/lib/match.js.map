{"version":3,"sources":["../src/match.ts"],"names":["matchPositions","trade","positions","legs","matched","map","position","overlapping","reduce","acc","leg","found_leg","find","p_leg","symbol","score","length","filter","x","sort","value","descending"],"mappings":";;;;;;;AAAA;;;;AAaO,SAASA,cAAT,CACLC,KADK,EAELC,SAFK,EAG4B;AACjC,MAAIC,IAAI,GAAGF,KAAK,CAACE,IAAjB;AAEA,MAAIC,OAAO,GAAGF,SAAS,CACpBG,GADW,CACNC,QAAD,IAAc;AACjB,QAAIC,WAAW,GAAGJ,IAAI,CAACK,MAAL,CAAY,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC1C,UAAIC,SAAS,GAAGL,QAAQ,CAACH,IAAT,CAAcS,IAAd,CACbC,KAAD,IAAWA,KAAK,CAACC,MAAN,KAAiBJ,GAAG,CAACI,MADlB,CAAhB;;AAGA,UAAIH,SAAJ,EAAe;AACbF,QAAAA,GAAG,IAAI,CAAP;AACD;;AACD,aAAOA,GAAP;AACD,KARiB,EAQf,CARe,CAAlB;AAUA,WAAO;AACLM,MAAAA,KAAK,EAAER,WAAW,GAAGD,QAAQ,CAACH,IAAT,CAAca,MAD9B;AAELT,MAAAA,WAFK;AAGLD,MAAAA;AAHK,KAAP;AAKD,GAjBW,EAkBXW,MAlBW,CAkBHC,CAAD,IAAOA,CAAC,CAACH,KAAF,GAAU,CAlBb,EAmBXI,IAnBW,CAmBN,sBAAO;AAAEC,IAAAA,KAAK,EAAE,OAAT;AAAkBC,IAAAA,UAAU,EAAE;AAA9B,GAAP,CAnBM,CAAd;AAqBA,SAAOjB,OAAP;AACD","sourcesContent":["import sorter from 'sorters';\nimport { OptionLeg } from './types';\n\nexport interface HasOptionLegs {\n  legs: OptionLeg[];\n}\n\nexport interface MatchingPositionScore<T> {\n  score: number;\n  overlapping: number;\n  position: T;\n}\n\nexport function matchPositions<T extends HasOptionLegs>(\n  trade: HasOptionLegs,\n  positions: T[]\n): Array<MatchingPositionScore<T>> {\n  let legs = trade.legs;\n\n  let matched = positions\n    .map((position) => {\n      let overlapping = legs.reduce((acc, leg) => {\n        let found_leg = position.legs.find(\n          (p_leg) => p_leg.symbol === leg.symbol\n        );\n        if (found_leg) {\n          acc += 1;\n        }\n        return acc;\n      }, 0);\n\n      return {\n        score: overlapping / position.legs.length,\n        overlapping,\n        position,\n      };\n    })\n    .filter((x) => x.score > 0)\n    .sort(sorter({ value: 'score', descending: true }));\n\n  return matched;\n}\n"],"file":"match.js"}